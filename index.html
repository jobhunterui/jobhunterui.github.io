<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Hunter - Web App</title>
    <link rel="stylesheet" href="css/app-base.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="stylesheet" href="css/modal.css">
    <link rel="stylesheet" href="css/learning.css">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">

    <!-- PWA meta tags and links -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JobHunter">
    <link rel="apple-touch-icon" href="/images/logo-192.png">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TH7Y2W8GC4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-TH7Y2W8GC4', {
            'send_page_view': false  // Don't send automatic page views
        });
    </script>
    <script src="/js/analytics.js"></script>
    <script src="js/enhanced-analytics.js"></script>
</head>

<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <img src="images/logo.png" alt="Job Hunter Logo">
                <h1>Job Hunter</h1>
            </div>
            <div class="auth-container">
                <button id="sign-in-button" class="auth-button">
                    Sign in with Google
                </button>
                <div id="user-profile" class="user-profile hidden">
                    <img id="user-avatar" src="" alt="User Avatar">
                    <span id="user-name">User</span>
                    <button id="sign-out-button" class="sign-out-button">Sign Out</button>
                </div>
                <div id="sync-status" class="sync-status">
                    <span id="sync-status-text">Offline</span>
                </div>
            </div>
        </div>
    </header>

    <main class="app-container">
        <div class="tabs">
            <button class="tab-button active" data-tab="find">Find Jobs</button>
            <button class="tab-button" data-tab="apply">Apply</button>
            <button class="tab-button" data-tab="profile">Profile</button>
            <button class="tab-button" data-tab="insights">Career Insights</button>
            <button class="tab-button" data-tab="learning">Learning</button>
        </div>

        <!-- Find Jobs Tab -->
        <div id="find" class="tab-content active">
            <h2>Find Jobs</h2>
            <form id="job-search-form">
                <!-- Role input field -->
                <div class="form-group">
                    <label for="role" class="form-label">Role:</label>
                    <input type="text" id="role" name="role" class="form-input" placeholder="e.g. Software Engineer">
                </div>

                <!-- Location input field -->
                <div class="form-group">
                    <label for="location" class="form-label">Location:</label>
                    <input type="text" id="location" name="location" class="form-input" placeholder="e.g. London, UK">
                </div>

                <!-- Experience level select field -->
                <div class="form-group">
                    <label for="experience" class="form-label">Experience Level:</label>
                    <select id="experience" name="experience" class="form-select">
                        <option value="">Any Level</option>
                        <option value="entry">Entry Level</option>
                        <option value="mid">Mid-Level</option>
                        <option value="senior">Senior</option>
                        <option value="lead">Lead/Manager</option>
                    </select>
                </div>

                <!-- Hiring Phrases Section -->
                <div class="toggle-section">
                    <div class="toggle-header" id="show-hiring-phrases">
                        <span class="toggle-icon">▶</span>
                        <span>Hiring Phrases to Search</span>
                    </div>
                    <div class="toggle-content" id="hiring-phrases-options">
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-hiring" name="hiring-phrase" value="we are hiring"
                                checked>
                            <label for="phrase-hiring">"we are hiring"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-team" name="hiring-phrase" value="join our team" checked>
                            <label for="phrase-team">"join our team"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-opening" name="hiring-phrase" value="job opening" checked>
                            <label for="phrase-opening">"job opening"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-position" name="hiring-phrase" value="open position"
                                checked>
                            <label for="phrase-position">"open position"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-now-hiring" name="hiring-phrase" value="now hiring"
                                checked>
                            <label for="phrase-now-hiring">"now hiring"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-looking" name="hiring-phrase" value="looking for" checked>
                            <label for="phrase-looking">"looking for"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-immediate" name="hiring-phrase" value="immediate opening"
                                checked>
                            <label for="phrase-immediate">"immediate opening"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-opportunities" name="hiring-phrase"
                                value="career opportunities" checked>
                            <label for="phrase-opportunities">"career opportunities"</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="phrase-remote" name="hiring-phrase" value="remote opportunity"
                                checked>
                            <label for="phrase-remote">"remote opportunity"</label>
                        </div>
                        <!-- Custom phrase input field -->
                        <div class="custom-option-input">
                            <input type="text" id="custom-phrase" class="form-input form-input-small"
                                placeholder="Add your own phrase">
                            <button id="add-custom-phrase" type="button" class="default-button">Add</button>
                        </div>
                    </div>
                </div>

                <!-- Job Boards Section -->
                <div class="toggle-section">
                    <div class="toggle-header" id="show-job-boards">
                        <span class="toggle-icon">▶</span>
                        <span>Job Boards to Search</span>
                    </div>
                    <div class="toggle-content" id="job-boards-options">
                        <p class="options-tip">Select specific job boards to search or leave all unchecked to search all
                            boards.</p>
                        <div class="toggle-option">
                            <input type="checkbox" id="board-lever" name="job-board" value="jobs.lever.co">
                            <label for="board-lever">Lever</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="board-greenhouse" name="job-board" value="boards.greenhouse.io">
                            <label for="board-greenhouse">Greenhouse</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="board-workable" name="job-board" value="apply.workable.com">
                            <label for="board-workable">Workable</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="board-ashby" name="job-board" value="ashbyhq.com">
                            <label for="board-ashby">Ashby</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="board-smart" name="job-board" value="jobs.smartrecruiters.com">
                            <label for="board-smart">SmartRecruiters</label>
                        </div>
                    </div>
                </div>

                <!-- Document Sites Section -->
                <div class="toggle-section">
                    <div class="toggle-header" id="show-doc-sites">
                        <span class="toggle-icon">▶</span>
                        <span>Document Sites to Search</span>
                    </div>
                    <div class="toggle-content" id="doc-sites-options">
                        <p class="options-tip">Select specific document sites to search or leave all unchecked to search
                            all sites.</p>
                        <div class="toggle-option">
                            <input type="checkbox" id="site-google" name="doc-site" value="docs.google.com">
                            <label for="site-google">Google Docs</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="site-notion" name="doc-site" value="notion.site">
                            <label for="site-notion">Notion</label>
                        </div>
                        <div class="toggle-option">
                            <input type="checkbox" id="site-coda" name="doc-site" value="coda.io">
                            <label for="site-coda">Coda</label>
                        </div>
                    </div>
                </div>

                <div class="search-buttons">
                    <button type="button" id="search-linkedin">Find on LinkedIn</button>
                    <button type="button" id="search-linkedin-feed">Find on LinkedIn Feed</button>
                    <button type="button" id="search-google">Find on Job Boards</button>
                    <button type="button" id="search-docs">Find in Docs and Pages</button>
                    <button type="button" id="search-ai">Find with AI</button>
                </div>
            </form>
        </div>

        <!-- Apply Tab -->
        <div id="apply" class="tab-content">
            <div class="apply-header">
                <h2>Saved Job Postings</h2>
                <button id="add-new-job-btn" class="primary-button">Add New Job</button>
            </div>

            <div class="saved-jobs-section">
                <h3>Your Saved Jobs</h3>
                <div class="refresh-section">
                    <button id="refresh-jobs" class="refresh-button" title="Refresh job list">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M23 4v6h-6"></path>
                            <path d="M1 20v-6h6"></path>
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"></path>
                            <path d="M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                        </svg>
                        Refresh
                    </button>
                </div>

                <div class="job-filters">
                    <label for="status-filter">Filter by status:</label>
                    <select id="status-filter" class="job-status-select">
                        <option value="all">All Statuses</option>
                        <option value="reviewing">Reviewing</option>
                        <option value="applied">Applied</option>
                        <option value="interviewing">Interviewing</option>
                        <option value="offer">Offer Received</option>
                        <option value="rejected">Rejected</option>
                        <option value="accepted">Accepted</option>
                        <option value="declined">Declined</option>
                    </select>
                </div>

                <div id="saved-jobs-list">
                    <!-- Jobs will be listed here dynamically -->
                    <div class="empty-state">No saved jobs yet. Add a new job below.</div>
                </div>

                <div class="pagination-controls hidden">
                    <button id="prev-page" class="default-button">&laquo; Previous</button>
                    <span id="page-info">Page 1 of 1</span>
                    <button id="next-page" class="default-button">Next &raquo;</button>
                </div>

                <div id="job-actions" class="hidden">
                    <div class="job-actions-container">
                        <div class="job-actions-group">
                            <h4 class="action-group-title">Auto Generation (Gemini Flash)</h4>
                            <p class="action-group-info">One-click AI generation - faster but less customizable</p>
                            <div class="action-buttons">
                                <button id="generate-cv-gemini" class="primary-button gemini-button">Generate CV
                                    (One-Click)</button>
                                <button id="generate-cover-letter-gemini" class="primary-button gemini-button">Generate
                                    Cover
                                    Letter</button>
                            </div>
                        </div>
                
                        <div class="job-actions-group">
                            <h4 class="action-group-title">Manual Generation (Claude 3.7)</h4>
                            <p class="action-group-info">Manual process with Claude - more control and higher quality
                            </p>
                            <div class="action-buttons">
                                <button id="generate-application" class="primary-button claude-button">Generate CV</button>
                                <button id="generate-cover-letter-claude" class="primary-button claude-button">Generate Cover Letter</button>
                            </div>
                        </div>
                
                        <div class="job-actions-group">
                            <h4 class="action-group-title">Other Actions</h4>
                            <div class="action-buttons">
                                <button id="interview-prep" class="secondary-button">Interview Prep</button>
                                <button id="remove-job" class="danger-button">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="job-entry-section">
                <h3>Add a New Job</h3>
                <p class="info-text">Copy job details from any job posting and paste them here.</p>

                <form id="job-entry-form">
                    <!-- Job entry form fields -->
                    <div class="form-group">
                        <label for="job-title" class="form-label">Job Title:</label>
                        <input type="text" id="job-title" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="job-company" class="form-label">Company:</label>
                        <input type="text" id="job-company" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label for="job-location" class="form-label">Location:</label>
                        <input type="text" id="job-location" class="form-input"
                            placeholder="e.g. Remote, London, New York">
                    </div>
                    <div class="form-group">
                        <label for="job-url" class="form-label">Job URL (optional):</label>
                        <input type="url" id="job-url" class="form-input form-url-input"
                            placeholder="e.g. https://company.com/jobs/position">
                    </div>
                    <div class="form-group">
                        <label for="job-description" class="form-label">Job Description:</label>
                        <textarea id="job-description" class="form-textarea" rows="10" required
                            placeholder="Paste the full job description here..."></textarea>
                    </div>
                    <button type="submit" id="save-job-btn" class="primary-button">Save Job</button>
                </form>
            </div>

        </div>

        <!-- Profile Tab -->
        <div id="profile" class="tab-content">
            <h2>Your Profile</h2>

            <!-- CV textarea in profile tab -->
            <div class="form-group">
                <label for="cv" class="form-label">Your CV/Resume:</label>
                <textarea id="cv" name="cv" class="form-textarea" rows="15"
                    placeholder="Paste your CV or resume text here..."></textarea>
                <p class="form-info">This information will be used to generate tailored applications for jobs you save.
                </p>
                <button id="save-profile" class="primary-button">Save CV</button>
            </div>

            <!-- Auth Status Section -->
            <div class="auth-status-section">
                <h3>Account Status</h3>
                <div id="auth-status">
                    <!-- Content will be dynamically updated based on auth state -->
                    <p>📱 Sign in to sync across devices</p>
                    <button id="sign-in-profile" class="primary-button">Sign In with Google</button>
                </div>
            </div>

            <!-- Subscription Section (Placeholder for Phase 4) -->
            <div class="subscription-section">
                <h3>Subscription</h3>
                <div id="subscription-status">
                    <p>Current plan: <strong>Free</strong></p>
                    <!-- Placeholder for Phase 4 premium upgrade -->
                </div>
            </div>

            <!-- JSON input in profile tab -->
            <div class="form-group">
                <label for="cv-json" class="form-label">Tailored CV/Cover Letter JSON:</label>
                <textarea id="cv-json" name="cv-json" class="form-textarea" rows="5"
                    placeholder="Paste the JSON from Claude here..."></textarea>
                <p class="form-info">After generating with Claude, paste the JSON response here to preview your document.</p>
                <div class="preview-buttons">
                    <button id="preview-cv" class="primary-button">Preview CV</button>
                    <button id="preview-cover-letter" class="primary-button">Preview Cover Letter</button>
                </div>
            </div>

            <!-- Export/Import section will be added by setupExportImport() in ui.js -->
        </div>

        <!-- Career Insights Tab -->
        <div id="insights" class="tab-content">
            <h2>Career Insights</h2>

            <div class="insights-job-selector">
                <label for="insights-job-select">Select a job to analyze:</label>
                <select id="insights-job-select" class="form-select">
                    <option value="">Choose a job...</option>
                    <!-- Options will be populated dynamically -->
                </select>
            </div>

            <div class="insights-welcome" id="insights-welcome">
                <p>Select a job from the Apply tab to see personalized career insights and skill recommendations.</p>
            </div>

            <div class="insights-content" id="insights-content" style="display: none;">
                <div class="insights-job-header">
                    <h3 id="insights-job-title">Position at Company</h3>
                    <p id="insights-job-company-location">Company • Location</p>
                </div>

                <div class="insights-section">
                    <div class="insights-card">
                        <h4 class="insights-section-title">Skills Match Analysis</h4>
                        <div class="skills-match-container">
                            <div class="skills-match-overview">
                                <div class="skills-match-meter">
                                    <div class="skills-match-value" id="skills-match-value">--</div>
                                    <div class="skills-match-label">Match</div>
                                </div>
                            </div>
                            <div class="skills-details">
                                <div class="matching-skills">
                                    <h5>Matching Skills</h5>
                                    <ul id="matching-skills-list">
                                        <li class="empty-list-message">Generate a CV for this job first</li>
                                    </ul>
                                </div>
                                <div class="missing-skills">
                                    <h5>Skills to Develop</h5>
                                    <ul id="missing-skills-list">
                                        <li class="empty-list-message">Generate a CV for this job first</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="insights-section">
                    <div class="insights-card">
                        <h4 class="insights-section-title">Learning Recommendations</h4>
                        <div id="learning-recommendations">
                            <p class="empty-recommendations">Generate a CV for this job to get personalized learning
                                recommendations.</p>
                        </div>
                        <div class="learning-actions" style="display: none;">
                            <button id="create-learning-plan" class="primary-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="perplexity-icon">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 16v-4"></path>
                                    <path d="M12 8h.01"></path>
                                </svg>
                                Create Learning Plan with AI
                            </button>
                        </div>
                    </div>
                </div>

                <div class="insights-section">
                    <div class="insights-card">
                        <h4 class="insights-section-title">Experience Highlights</h4>
                        <div id="experience-highlights">
                            <p class="empty-highlights">Generate a CV for this job to see which of your experiences are
                                most relevant.</p>
                        </div>
                    </div>
                </div>

            </div>

            <div class="insights-section cumulative-section" id="cumulative-section">
                <div class="insights-card">
                    <h4 class="insights-section-title">Cumulative Skill Analysis</h4>
                    <div id="cumulative-skills-analysis">
                        <p class="empty-analysis">Generate CVs for multiple jobs to see common skill requirements.</p>
                        <div class="skills-tracker" style="display: none;">
                            <div class="most-requested-skills">
                                <h5>Most Requested Skills</h5>
                                <ul id="most-requested-skills-list"></ul>
                            </div>
                            <div class="skill-gap-summary">
                                <h5>Your Top Skill Gaps</h5>
                                <ul id="skill-gap-summary-list"></ul>
                            </div>
                        </div>
                        <div class="create-career-plan-btn" style="text-align: center; margin-top: 20px; width: 100%;">
                            <button id="create-cumulative-learning-plan" class="primary-button">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="perplexity-icon">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 16v-4"></path>
                                    <path d="M12 8h.01"></path>
                                </svg>
                                Create Career Learning Plan
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Learning Dashboard Tab -->
        <div id="learning" class="tab-content">
            <h2>Learning Dashboard</h2>

            <!-- Empty state - shown when no learning plan is loaded -->
            <div id="learning-empty-state" class="learning-empty-state">
                <h3>Track Your Professional Learning Journey</h3>
                <p>Create a personalized learning plan based on the skill gaps identified in your Career Insights.
                    Generate a learning plan with Perplexity, then paste the JSON here to build your interactive
                    dashboard.</p>

                <div class="learning-json-input">
                    <label for="learning-plan-json" class="form-label">Paste Learning Plan JSON:</label>
                    <textarea id="learning-plan-json" class="form-textarea"
                        placeholder="Paste the learning plan JSON from Perplexity here..."></textarea>
                    <p class="form-info">Generate a plan in Career Insights tab, paste it to Perplexity, then paste the
                        JSON response back here.</p>
                    <button id="load-learning-plan" class="primary-button">Load Learning Plan</button>
                </div>

                <div class="learning-empty-actions">
                    <button id="go-to-insights" class="secondary-button">Go to Career Insights</button>
                    <button id="view-example-plan" class="default-button">View Example Plan</button>
                </div>
            </div>

            <!-- Dashboard - shown when a learning plan is loaded -->
            <div id="learning-dashboard" class="learning-dashboard">
                <!-- Dashboard header -->
                <div class="learning-header">
                    <div>
                        <h3 id="learning-plan-title" class="learning-plan-title">Career Learning Plan</h3>
                        <p id="learning-plan-meta" class="learning-plan-meta">Created on: <span
                                id="plan-created-date">-</span></p>
                    </div>
                    <div class="learning-header-actions">
                        <button id="edit-learning-plan" class="default-button">Edit Plan</button>
                        <button id="reset-learning-plan" class="secondary-button">Reset Progress</button>
                    </div>
                </div>

                <!-- Overall progress -->
                <div class="learning-progress-container">
                    <div class="learning-progress-stat">
                        <div class="learning-stat-item">
                            <div id="skills-count" class="learning-stat-value">0</div>
                            <div class="learning-stat-label">Skills</div>
                        </div>
                        <div class="learning-stat-item">
                            <div id="resources-count" class="learning-stat-value">0</div>
                            <div class="learning-stat-label">Resources</div>
                        </div>
                        <div class="learning-stat-item">
                            <div id="projects-count" class="learning-stat-value">0</div>
                            <div class="learning-stat-label">Projects</div>
                        </div>
                        <div class="learning-stat-item">
                            <div id="overall-progress" class="learning-stat-value">0%</div>
                            <div class="learning-stat-label">Completed</div>
                        </div>
                    </div>
                    <div class="learning-overall-progress">
                        <div id="progress-bar" class="learning-progress-bar"></div>
                    </div>
                </div>

                <!-- Dashboard navigation -->
                <div class="learning-nav">
                    <button class="learning-nav-item active" data-section="skills">Skills</button>
                    <button class="learning-nav-item" data-section="timeline">Timeline</button>
                    <button class="learning-nav-item" data-section="resources">Resources Library</button>
                </div>

                <!-- Dashboard content -->
                <div class="learning-content">
                    <!-- Skills section -->
                    <div id="skills-section" class="learning-section active">
                        <div id="skills-grid" class="learning-skills-grid">
                            <!-- Skills cards will be inserted here -->
                        </div>
                    </div>

                    <!-- Timeline section -->
                    <div id="timeline-section" class="learning-section">
                        <div id="timeline-container" class="timeline-container">
                            <!-- Timeline weeks will be inserted here -->
                        </div>
                    </div>

                    <!-- Resources section -->
                    <div id="resources-section" class="learning-section">
                        <div id="resources-library">
                            <!-- Resources will be inserted here -->
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <img src="images/logo-small.png" alt="Job Hunter Logo">
                <span>Job Hunter</span>
            </div>
            <div class="footer-links">
                <!-- Footer links -->
            </div>
        </div>
        <div class="copyright">
            <p>&copy; <span id="current-year"></span> Job Hunter. All rights reserved.</p>
        </div>
    </footer>

    <!-- Scripts -->
    <script>
        // Track that user accessed the web app
        document.addEventListener('DOMContentLoaded', function () {
            if (typeof trackEvent === 'function') {
                trackEvent('web_app_access', {
                    referrer: document.referrer
                });
            } else {
                console.error('trackEvent function not available. Check analytics.js implementation.');
            }
        });
    </script>
    <script type="module" src="js/firebase-config.js"></script>
    <script src="js/cloud-sync.js" defer></script>
    <script src="js/storage.js" defer></script>
    <script src="js/tracking.js" defer></script>
    <script src="js/unified-tracking.js" defer></script>
    <script src="js/ui.js" defer></script>
    <script src="js/cv-api.js" defer></script>
    <script src="js/search.js" defer></script>
    <script src="js/prompts.js" defer></script>
    <script src="js/app.js" defer></script>
    <script src="js/pwa.js" defer></script>
    <script src="js/insights.js" defer></script>
    <script src="js/learning.js" defer></script>
</body>

</html>